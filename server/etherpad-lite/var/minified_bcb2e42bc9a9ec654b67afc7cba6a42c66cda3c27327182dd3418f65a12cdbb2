require.define({"ep_image_upload/static/js/toolbar.js": {"(module ep_image_upload/static/js/toolbar.js)": function (require, exports, module) {"use strict";const _handleNewLines=s=>{const r=s.ace_getRep(),t=r.selStart[0];return r.lines.atIndex(t).text?(s.ace_doReturnKey(),t+1):t},_isValid=s=>{const t=clientVars.ep_image_upload.mimeTypes[s.type];let n=null;const d=html10n.get("ep_image_upload.error.title");if(clientVars.ep_image_upload&&clientVars.ep_image_upload.fileTypes){if(n=!1,t&&t.extensions)for(const a of clientVars.ep_image_upload.fileTypes)t.extensions.indexOf(a)>-1&&(n=!0);if(n===!1){const a=html10n.get("ep_image_upload.error.fileType");return $.gritter.add({title:d,text:a,sticky:!0,class_name:"error"}),!1}}if(clientVars.ep_image_upload&&s.size>clientVars.ep_image_upload.maxFileSize){const a=clientVars.ep_image_upload.maxFileSize/1e6,i=html10n.get("ep_image_upload.error.fileSize",{maxallowed:a});return $.gritter.add({title:d,text:i,sticky:!0,class_name:"error"}),!1}return!0};exports.postToolbarInit=(s,r)=>{r.toolbar.registerCommand("imageUpload",()=>{$(document).find("body").find("#imageInput").remove(),$(document).find("body").append(`<input
    style="width:1px;height:1px;z-index:-10000;"
    id="imageInput" type="file" />`),$(document).find("body").find("#imageInput").on("change",d=>{const a=d.target.files;if(!a.length)return"Please choose a file to upload first.";const i=a[0];if(_isValid(i))if(clientVars.ep_image_upload.storageType==="base64"){$("#imageUploadModalLoader").removeClass("popup-show");const l=new FileReader;l.readAsDataURL(i),l.onload=()=>{const o=l.result;r.ace.callWithAce(e=>{const p=_handleNewLines(e);e.ace_addImage(p,o),e.ace_doReturnKey()},"img",!0)}}else{const l=new FormData;l.append("file",i,i.name),$("#imageUploadModalLoader").addClass("popup-show"),$.ajax({type:"POST",url:`${clientVars.padId}/pluginfw/ep_image_upload/upload`,xhr:()=>$.ajaxSettings.xhr(),success:o=>{$("#imageUploadModalLoader").removeClass("popup-show"),r.ace.callWithAce(e=>{const p=_handleNewLines(e);e.ace_addImage(p,o),e.ace_doReturnKey()},"img",!0)},error:o=>{let e;try{e=JSON.parse(o.responseText.trim()),e.type&&(e.message=`ep_image_upload.error.${e.type}`)}catch{e={message:o.responseText}}const p=html10n.get("ep_image_upload.error.title"),m=html10n.get(e.message);$.gritter.add({title:p,text:m,sticky:!0,class_name:"error"})},async:!0,data:l,cache:!1,contentType:!1,processData:!1,timeout:6e4})}}),$(document).find("body").find("#imageInput").trigger("click")})};
}}["(module ep_image_upload/static/js/toolbar.js)"],
});
