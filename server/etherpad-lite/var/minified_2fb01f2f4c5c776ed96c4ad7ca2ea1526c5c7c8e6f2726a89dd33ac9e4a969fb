require.define({"ep_comments_page/static/js/commentIcons.js": {"(module ep_comments_page/static/js/commentIcons.js)": function (require, exports, module) {"use strict";const commentBoxes=require("ep_comments_page/static/js/commentBoxes"),displayIcons=()=>clientVars.displayCommentAsIcon;let padOuter;const getPadOuter=()=>(padOuter=padOuter||$('iframe[name="ace_outer"]').contents(),padOuter);let padInner;const getPadInner=()=>(padInner=padInner||getPadOuter().find('iframe[name="ace_inner"]').contents(),padInner),getOrCreateIconsContainerAt=n=>{const t=getPadOuter().find("#commentIcons"),e=`icon-at-${n}`;let o=t.find(`.${e}`);return o.length===0&&(t.append(`<div class="comment-icon-line ${e}"></div>`),o=t.find(`.${e}`),o.css("top",`${n}px`)),o},targetCommentIdOf=n=>n.currentTarget.getAttribute("data-commentid"),highlightTargetTextOf=n=>{getPadInner().find("head").append(`<style class='comment-style'>.${n}{ color: #a7680c !important }</style>`)},removeHighlightTargetText=()=>{getPadInner().find("head .comment-style").remove()},toggleActiveCommentIcon=n=>{n.toggleClass("active").toggleClass("inactive")},addListenersToCommentIcons=()=>{getPadOuter().find("#commentIcons").on("mouseover",".comment-icon",n=>{removeHighlightTargetText();const t=targetCommentIdOf(n);highlightTargetTextOf(t)}).on("mouseout",".comment-icon",n=>{removeHighlightTargetText()}).on("click",".comment-icon.active",function(n){toggleActiveCommentIcon($(this));const t=targetCommentIdOf(n);commentBoxes.hideComment(t,!0)}).on("click",".comment-icon.inactive",function(n){commentBoxes.hideAllComments();const t=getPadOuter().find("#commentIcons").find(".comment-icon.active");toggleActiveCommentIcon(t),toggleActiveCommentIcon($(this));const e=targetCommentIdOf(n);commentBoxes.highlightComment(e,n)})},addListenersToCloseOpenedComment=()=>{$(document).on("touchstart click",n=>{closeOpenedCommentIfNotOnSelectedElements(n)}),getPadOuter().find("html").on("touchstart click",n=>{closeOpenedCommentIfNotOnSelectedElements(n)}),getPadInner().find("html").on("touchstart click",n=>{closeOpenedCommentIfNotOnSelectedElements(n)})},closeOpenedCommentIfNotOnSelectedElements=n=>{if(shouldNotCloseComment(n)||commentBoxes.shouldNotCloseComment(n))return;const t=findOpenedComment();if(t){toggleActiveCommentIcon($(t));const e=t.getAttribute("data-commentid");commentBoxes.hideComment(e,!0)}},findOpenedComment=()=>getPadOuter().find("#commentIcons .comment-icon.active").get(0),insertContainer=()=>{displayIcons()&&(getPadOuter().find("#sidediv").after('<div id="commentIcons"></div>'),getPadOuter().find("#comments").addClass("with-icons"),addListenersToCommentIcons(),addListenersToCloseOpenedComment())},addIcon=(n,t)=>{if(!displayIcons())return;const o=getPadInner().find(`.comment.${n}`).get(0).offsetTop,c=getOrCreateIconsContainerAt(o);$("#commentIconTemplate").tmpl(t).appendTo(c)},hideIcons=()=>{displayIcons()&&getPadOuter().find("#commentIcons").children().children().each(function(){$(this).hide()})},adjustTopOf=(n,t)=>{if(!displayIcons())return;const e=getPadOuter().find(`#icon-${n}`),c=getOrCreateIconsContainerAt(t);return c!==e.parent()&&e.appendTo(c),e.show(),e},isCommentOpenedByClickOnIcon=()=>displayIcons()?getPadOuter().find("#commentIcons").find(".comment-icon.active").length!==0:!1,commentHasReply=n=>{if(!displayIcons())return;getPadOuter().find("#commentIcons").find(`#icon-${n}`).addClass("with-reply")},shouldShow=n=>{let t=!1;return displayIcons()?n.hasClass("mouseover")&&(t=!0):t=!0,t},shouldNotCloseComment=n=>$(n.target).closest(".comment-icon").length!==0;exports.insertContainer=insertContainer,exports.addIcon=addIcon,exports.hideIcons=hideIcons,exports.adjustTopOf=adjustTopOf,exports.isCommentOpenedByClickOnIcon=isCommentOpenedByClickOnIcon,exports.commentHasReply=commentHasReply,exports.shouldShow=shouldShow,exports.shouldNotCloseComment=shouldNotCloseComment;
}}["(module ep_comments_page/static/js/commentIcons.js)"],
});
