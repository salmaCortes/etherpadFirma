require.define({"ep_cursortrace/static/js/main.js": {"(module ep_cursortrace/static/js/main.js)": function (require, exports, module) {"use strict";let initiated=!1,last,globalKey=0;exports.aceInitInnerdocbodyHead=(s,e,n)=>{e.iframeHTML.push('<link rel="stylesheet" type="text/css" href="../static/plugins/ep_cursortrace/static/css/ace_inner.css"/>'),n()},exports.postAceInit=(s,e,n)=>{initiated=!0,n()},exports.getAuthorClassName=s=>s?`ep_real_time_chat-${s.replace(/[^a-y0-9]/g,n=>n==="."?"-":`z${n.charCodeAt(0)}z`)}`:!1,exports.className2Author=s=>{if(s.substring(0,7)==="author-")return s.substring(7).replace(/[a-y0-9]+|-|z.+?z/g,e=>e==="-"?".":e.charAt(0)==="z"?String.fromCharCode(Number(e.slice(1,-1))):e)},exports.aceEditEvent=(s,e)=>{if((e.callstack.editEvent.eventType==="handleClick"||e.callstack.type==="handleKeyEvent"||e.callstack.type==="idleWorkTimer")&&initiated){const r=e.rep.selStart[0],o=e.rep.selStart[1];if(!last||r!==last[0]||o!==last[1]){const t=pad.getUserId(),i=pad.getPadId(),a={type:"cursor",action:"cursorPosition",locationY:r,locationX:o,padId:i,myAuthorId:t};last=[],last[0]=r,last[1]=o,pad.collabClient.sendMessage(a)}}},exports.handleClientMessage_CUSTOM=(s,e,n)=>{const r=e.payload.action,o=e.payload.authorId;if(pad.getUserId()===o)return!1;const t=exports.getAuthorClassName(o);if(r==="cursorPosition"){let i=e.payload.authorName;(i==="null"||i==null)&&(i="\u{1F60A}");const a=e.payload.locationY+1;let y=e.payload.locationX;const k=$('iframe[name="ace_outer"]').contents().find("iframe");let I;k.length!==0&&(I=parseInt($(k).offset().left),I+=parseInt($(k).css("padding-left")));let v=!1;const l=$('iframe[name="ace_outer"]').contents().find("iframe").contents().find("#innerdocbody").find(`div:nth-child(${a})`),T=l.width();if(l.length!==0){let c=$(l).offset().top;c+=parseInt($('iframe[name="ace_outer"]').contents().find("iframe").css("paddingTop"));const w=$(l).html(),b=`hiddenUgly${exports.getAuthorClassName(o)}`;$(l).children("span").length<1&&(y-=1);const M=html_substr(w,y),N=`<span style='width:${T}px' id='${b}' class='ghettoCursorXPos'>${M}</span>`;globalKey=0,$('iframe[name="ace_outer"]').contents().find("#outerdocbody").append(N);const u=$('iframe[name="ace_outer"]').contents().find("#outerdocbody").find(`#${b}`);$(u).html(wrap($(u)));const m=$(u).find(`[data-key="${y-1}"]`);let p;m.length!==0?p=m.position().left:p=0;const A=u.height();c=c+A-(m.height()||12),c<=0&&(v=!0,c+=m.height()*2,c<0&&(c=0)),p+=I;let d=$(l).css("margin-left"),f=$(l).parent().css("padding-left");f?f=parseInt(f):f=0,d&&(d=d.replace("px",""),d=parseInt(d),d+f>0&&(p+=d)),p+=18,$('iframe[name="ace_outer"]').contents().find("#outerdocbody").contents().remove(`#${b}`);const U=pad.collabClient.getConnectedUsers();$.each(U,(E,g)=>{if(g.userId===o){const x=pad.getColorPalette();let _;x[g.colorId]?_=x[g.colorId]:_=g.colorId;const z=$('iframe[name="ace_outer"]').contents().find("#outerdocbody");$('iframe[name="ace_outer"]').contents().find(`.caret-${t}`).remove();const C=v?"stickUp":"stickDown",h=$(`<div class='caretindicator ${C} caret-${t}'
              style='height:16px;left:${p}px;top:${c}px;background-color:${_}'>
              <p class='stickp ${C}'></p></div>`);h.attr("title",i),h.find("p").text(i),$(z).append(h),setTimeout(()=>{h.fadeOut(500,()=>{h.remove()})},2e3)}})}}return n()};const html_substr=(s,e)=>{const n=document.createElement("div");n.innerHTML=s;const r=t=>{if(e>0){const i=t.data.length;e-=i,e<=0&&(t.data=t.substringData(0,t.data.length+e))}else t.data=""},o=(t,i)=>{let a=t.firstChild;if(a)do a.nodeType===3?i(a):a.nodeType===1&&a.childNodes&&a.childNodes[0]&&o(a,i);while(a=a.nextSibling)};return o(n,r),n.innerHTML},wrap=s=>{const e=$("<div></div>"),n=s.contents().clone();if(n)return n.each(function(){if(this.nodeType===3){let r="";const o=this.wholeText;for(let t=0;t<o.length;t++)o[t]===" "?r+=`<span data-key=${globalKey}> </span>`:r+=`<span data-key=${globalKey}>${o[t]}</span>`,globalKey++;e.append($(r))}else $(this).html(wrap($(this))),e.append($(this))}),e.html()};
}}["(module ep_cursortrace/static/js/main.js)"],
});
